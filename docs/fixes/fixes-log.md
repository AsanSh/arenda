# История исправлений

Этот файл содержит хронологию всех исправлений и решений проблем в проекте.

---

## 2026-01-25 - Исправление уникальности номеров телефонов

**Проблема:** Два контрагента с одинаковым номером телефона (+996557903999)

**Решение:**
- Добавлена уникальность номера телефона в модель Tenant
- Объединены дубликаты контрагентов
- Создана детальная страница контрагента

**Файлы:** `backend/core/models.py`, `backend/core/serializers.py`, `admin-frontend/src/pages/TenantDetailPage.tsx`

---

## 2026-01-25 - Исправление CSRF при входе через WhatsApp OTP

**Проблема:** Ошибка 403 Forbidden "CSRF token missing" при запросе OTP кода

**Решение:**
- Применен `csrf_exempt` в URL-конфигурации для публичных эндпоинтов
- Отключен `SessionAuthentication` для эндпоинтов OTP
- Обновлены настройки CSRF в `settings.py`

**Файлы:** `backend/core/urls.py`, `backend/core/whatsapp_auth_views.py`, `backend/amt/settings.py`

---

## 2026-01-25 - Исправление прав доступа для арендаторов

**Проблема:** Арендаторы видели админские функции (добавить договор, начисления, уведомления)

**Решение:**
- Исправлена логика меню в `useUserMenu.ts`
- Скрыты кнопки добавления/редактирования для арендаторов
- Ограничен доступ к странице уведомлений

**Файлы:** `admin-frontend/src/hooks/useUserMenu.ts`, `admin-frontend/src/pages/ContractsPage.tsx`, `admin-frontend/src/pages/AccrualsPage.tsx`, `admin-frontend/src/pages/NotificationsPage.tsx`

---

## 2026-01-25 - Исправление отображения номера телефона

**Проблема:** Номер телефона не отображался в боковом меню и профиле

**Решение:**
- Добавлено отображение номера в `Layout.tsx`
- Автозаполнение номера в профиле
- Сохранение номера в localStorage при входе

**Файлы:** `admin-frontend/src/components/Layout.tsx`, `admin-frontend/src/pages/SettingsPage.tsx`, `admin-frontend/src/contexts/UserContext.tsx`

---

## 2026-01-24 - Исправление ошибки авторизации администратора

**Проблема:** Администратор входил как арендатор

**Решение:**
- Обновлен тип контрагента "Администратор" на `admin`
- Обновлена роль пользователя на `admin`
- Добавлена защита от удаления администратора

**Файлы:** `backend/core/models.py`, `backend/core/views.py`

---

## Ранее исправленные проблемы

(Старые файлы FIX_*.md были объединены в этот лог)

